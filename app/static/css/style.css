/* =================================
   VARIÁVEIS GLOBAIS E ESTILOS DE BASE (v2.0)
   ================================= */
:root {
    --cor-primaria: #0d6efd;
    --cor-sucesso: #198754;
    --cor-aviso: #ffc107;
    --cor-perigo: #dc3545;
    --cor-texto: #212529;
    --cor-fundo-claro: #f8f9fa;
    --cor-borda: #dee2e6;
}
/* Adicionado para evitar seleção de texto durante o arrasto de elementos flutuantes */
body.is-dragging,
body.is-dragging-card {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

/* =================================
   COMPONENTES GERAIS
   ================================= */

.clickable-header {
    cursor: pointer;
}

.clickable-header .bi-chevron-down {
    transition: transform 0.2s ease-in-out;
}

.clickable-header[aria-expanded="true"] .bi-chevron-down {
    transform: rotate(180deg);
}

/* --- Utilitários --- */
.item-icon-sm {
    height: 24px;
    width: 24px;
    vertical-align: middle;
    object-fit: contain;
}

.progress-thin {
    height: 6px;
}

.bg-dark-subtle-item-list {
    background-color: rgba(0,0,0,0.15);
    border-radius: 5px;
}

/* --- Sistema Global de Ícones --- */

.icon {
    /* Propriedades base para TODOS os ícones */
    display: inline-block;
    width: auto; /* Largura automática para manter a proporção */
    vertical-align: middle;
    object-fit: contain; /* A propriedade mais importante para evitar distorção */
}
/* Modificadores de Tamanho */
.icon.icon-1x {
    height: 16px; /* Tamanho pequeno, para botões e texto */
    max-width: 24px;
}

.icon.icon-2x {
    height: 24px; /* Tamanho médio, para listas principais */
    max-width: 48px;
}

.icon.icon-3x {
    height: 32px; /* Tamanho grande, para destaque como no Códice */
    max-width: 64px;
}

/* --- Cards do Painel --- */

.dashboard-card {
    height: 100%;
    border: 1px solid var(--cor-borda);
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}

.dashboard-card .card-header {
    padding: 0.75rem 1rem;
    font-weight: 500;
    background-color: var(--cor-fundo-claro);
    border-bottom: 1px solid var(--cor-borda);
}

.dashboard-card .card-body {
    padding: 1rem;
}

/* =================================
   PAINÉIS ESPECÍFICOS
   ================================= */

/* --- Painel de Expansão --- */

/* --- Card: Você está aqui --- */
.expansion-timer-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background-color: #e9ecef;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
    margin-top: 1.25rem;
}

.completed-icon-stack {
    position: relative;
    display: grid;
    place-items: center;
    width: 102px;
    height: 92px;
}

.completed-icon-stack .stack-layer {
    grid-area: 1 / 1;
}

.completed-icon-stack .base-layer {
    width: 100%;
    height: auto;
}

.completed-icon-stack .middle-layer,
.completed-icon-stack .top-layer-animated {
    width: 30%;
}

.completed-icon-stack .top-layer-animated {
    animation: pulse-checkmark 2s infinite ease-in-out;
}

@keyframes pulse-checkmark {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.15);
    }
    100% {
        transform: scale(1);
    }
}

.expansion-timer-card .timer-icon img.construction-gif-timer {
    width: 150px;
    height: 80px;
}

.expansion-timer-card .timer-details {
    line-height: 1.4;
    width: 100%;
}

.expansion-timer-card .timer-title {
    font-size: 0.8rem;
    font-weight: 700;
}

.expansion-timer-card .countdown-time {
    font-size: 1.2rem;
    font-weight: 700;
    font-family: monospace;
    color: var(--cor-sucesso);
}

.level-nodes-container {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--cor-borda);
}

.nodes-title {
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
/* --- Card: Planejador de Expansão --- */
@media (min-width: 992px) {
    .border-end-lg-custom {
        border-right: 1px solid var(--cor-borda);
    }
}

/* Classe customizada para borda em breakpoints específicos, usada nos painéis */
@media (min-width: 768px) { /* md breakpoint */
    .border-end-md-custom {
        border-right: 1px solid var(--cor-borda);
    }
}

.map-controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

#map-filter-tabs {
    flex-wrap: wrap;
    gap: 0.25rem; /* Adiciona um pequeno espaçamento se os botões quebrarem a linha */
}

#map-filter-tabs .btn.active {
    color: white;
}
#map-filter-tabs .btn[data-island-filter="basic"].active {
    background-color: #28a745;
    border-color: #28a745;
}
#map-filter-tabs .btn[data-island-filter="petal"].active {
    background-color: #4de706;
    border-color: #4de706;
}
#map-filter-tabs .btn[data-island-filter="desert"].active {
    background-color: #ffc107;
    border-color: #ffc107;
}
#map-filter-tabs .btn[data-island-filter="volcano"].active {
    background-color: #3a3a3a;
    border-color: #3a3a3a;
}
#map-filter-tabs .btn[data-island-filter="swamp"].active {
    background-color: #20c997;
    border-color: #20c997;
}

.expansion-map-wrapper {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #f8f9fa;
    border-radius: 0.5rem;
    padding: 0.75rem;
    min-height: 310px;
}

#expansion-map-grid {
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
    gap: 4px;
    width: 100%; /* Ocupa toda a largura do contentor cinzento */
    max-width: 400px; /* Define um tamanho máximo para não ficar gigante em ecrãs grandes */
    margin: 0 auto; /* Centra o mapa no contentor */
    aspect-ratio: 1 / 1; /* Força a grelha a ser um quadrado perfeito */
}

.map-plot {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.7rem;
    font-weight: 700;
    color: white;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
    border-radius: 4px;
    border: 1px solid rgba(0,0,0,0.2);
    transition: all 0.2s ease-in-out;
    cursor: help;
}

/* Posicionamento de cada lote via classe */
.plot-1 { grid-area: 5 / 5; } .plot-2 { grid-area: 5 / 6; } .plot-3 { grid-area: 4 / 6; }
.plot-4 { grid-area: 4 / 5; } .plot-5 { grid-area: 4 / 4; } .plot-6 { grid-area: 5 / 4; }
.plot-7 { grid-area: 6 / 4; } .plot-8 { grid-area: 6 / 5; } .plot-9 { grid-area: 6 / 6; }
.plot-10 { grid-area: 6 / 7; } .plot-11 { grid-area: 5 / 7; } .plot-12 { grid-area: 4 / 7; }
.plot-13 { grid-area: 3 / 7; } .plot-14 { grid-area: 3 / 6; } .plot-15 { grid-area: 3 / 5; }
.plot-16 { grid-area: 3 / 4; } .plot-17 { grid-area: 3 / 3; } .plot-18 { grid-area: 4 / 3; }
.plot-19 { grid-area: 5 / 3; } .plot-20 { grid-area: 6 / 3; } .plot-21 { grid-area: 7 / 3; }
.plot-22 { grid-area: 7 / 4; } .plot-23 { grid-area: 7 / 5; } .plot-24 { grid-area: 7 / 6; }
.plot-25 { grid-area: 7 / 7; } .plot-26 { grid-area: 7 / 8; } .plot-27 { grid-area: 6 / 8; }
.plot-28 { grid-area: 5 / 8; } .plot-29 { grid-area: 4 / 8; } .plot-30 { grid-area: 3 / 8; }
.plot-31 { grid-area: 2 / 8; } .plot-32 { grid-area: 2 / 7; } .plot-33 { grid-area: 2 / 6; }
.plot-34 { grid-area: 2 / 5; } .plot-35 { grid-area: 2 / 4; } .plot-36 { grid-area: 2 / 3; }

/* Estilos de estado e ilha do mapa */
.map-plot.island-basic { background-color: #28a745; }
.map-plot.island-petal { background-color: #4de706; }
.map-plot.island-desert { background-color: #ffc107; }
.map-plot.island-volcano { background-color: #3a3a3a; }
.map-plot.island-swamp { background-color: #20c997; }

.map-plot.state-owned { opacity: 0.9; }
.map-plot.state-in_progress {
    border: 2px solid #0dcaf0;
    animation: pulse-blue 1.5s infinite;
}
.map-plot.state-construction_complete {
    border: 2px solid var(--cor-primaria);
    animation: pulse-blue 1.5s infinite;
}
/*.map-plot.state-next_available {
    border: 2px solid #0dcaf0;
    transform: scale(1.1);
    background-color: #0dcaf0;
}
    */
.map-plot.state-locked {
    opacity: 0.4;
    background-color: #6c757d;
}
.map-plot.is-filtered {
    opacity: 0.2;
    pointer-events: none;
}
.map-plot:hover {
    transform: scale(1.2);
    z-index: 10;
    border-color: #fff !important;
}

@keyframes pulse-blue {
    0% {
        box-shadow: 0 0 5px 0px rgba(13, 110, 253, 0.7);
    }
    50% {
        box-shadow: 0 0 12px 4px rgba(13, 110, 253, 1);
    }
    100% {
        box-shadow: 0 0 5px 0px rgba(13, 110, 253, 0.7);
    }
}

/* Legenda e Tooltip do Mapa */
.map-legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem 1rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--cor-borda);
}
.legend-item {
    display: flex;
    align-items: center;
    font-size: 0.75rem;
}
.legend-color {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 3px;
    margin-right: 0.4rem;
    border: 1px solid rgba(0,0,0,0.2);
}
.legend-color.island-basic { background-color: #28a745; }
.legend-color.island-petal { background-color: #4de706; }
.legend-color.island-desert { background-color: #ffc107; }
.legend-color.island-volcano { background-color: #3a3a3a; }
.legend-color.island-swamp { background-color: #20c997; }

.legend-color.state-locked { background-color: #6c757d; }
.legend-color.state-in_progress,
.legend-color.state-construction_complete {
    animation: pulse-blue 1.5s infinite;
}

.map-tooltip {
    position: fixed;
    z-index: 1000;
    padding: 0.75rem;
    background-color: rgba(255,255,255,0.95);
    color: var(--cor-texto);
    border-radius: 0.5rem;
    font-size: 0.8rem;
    max-width: 250px;
    pointer-events: none;
    border: 1px solid var(--cor-borda);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    backdrop-filter: blur(5px);
}
.tooltip-title {
    font-weight: bold;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid var(--cor-borda);
    padding-bottom: 0.5rem;
}
.tooltip-list {
    list-style: none;
    padding: 0;
    margin: 0;
}
.tooltip-list-header {
    font-weight: 600;
    color: var(--cor-primaria);
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
}
.tooltip-list li {
    padding: 0.1rem 0;
}
.unlocks-header {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    margin-top: 0.5rem;
    color: var(--cor-texto);
}

/* --- Painel de Pesca e Conquistas --- */

.table-success-light,
.table-success-light > th,
.table-success-light > td {
    --bs-table-accent-bg: #d1e7dd;
    color: var(--bs-table-color-state, var(--bs-success-text-emphasis));
}

.codex-item {
    position: relative;
    border: 1px solid #dee2e6;
    padding: 4px;
    border-radius: 4px;
    background-color: #f8f9fa;
}


.codex-item.not-caught .icon {
    filter: grayscale(100%) opacity(60%);
}
.codex-check {
    position: absolute;
    bottom: -5px;
    right: -5px;
    color: var(--cor-sucesso);
    background-color: white;
    border-radius: 50%;
}

.milestones-mini-cards-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
}

.milestone-mini-card {
    height: 70px;
    display: flex;
    flex-direction: column;
    padding: 0.5rem;
    border: 2px solid var(--cor-borda);
    border-radius: 0.375rem;
    background-color: #fff;
    cursor: pointer;
    text-decoration: none;
    color: var(--cor-texto);
    transition: all 0.2s ease;
}

.milestone-mini-card.is-completed {
    background-color: #e8f5e9;
}

.milestone-mini-card.active,
.milestone-mini-card:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    opacity: 1;
    filter: grayscale(0);
}

.milestone-mini-card.is-inactive {
    opacity: 0.5;
    filter: grayscale(90%);
    pointer-events: none;
}

.milestone-mini-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.milestone-mini-card-title {
    font-size: 0.8rem;
    font-weight: bold;
    line-height: 1.2;
}

.milestone-details-wrapper {
    margin-top: 1rem;
}

.milestone-detail-pane {
    padding: 1rem;
    background-color: var(--cor-fundo-claro);
    border-radius: 0.375rem;
}

.milestone-mini-card.tier-basic {
    border-color: #a0a0a0;
}
.milestone-mini-card.tier-advanced {
    border-color: #4a90e2;
}
.milestone-mini-card.tier-expert {
    border-color: #d0a000;
}

.milestone-mini-card.active.tier-basic, 
.milestone-mini-card:hover.tier-basic {
    border-color: #777;
}
.milestone-mini-card.active.tier-advanced, 
.milestone-mini-card:hover.tier-advanced {
    border-color: #2a70c2;
}
.milestone-mini-card.active.tier-expert, 
.milestone-mini-card:hover.tier-expert {
    border-color: #b08000;
}

.milestone-mini-card.is-completed .bi-check-circle-fill {
    color: var(--cor-sucesso);
}

.milestone-mini-card.tier-basic .progress-bar {
    background-color: #a0a0a0;
}
.milestone-mini-card.tier-advanced .progress-bar {
    background-color: #4a90e2;
}
.milestone-mini-card.tier-expert .progress-bar {
    background-color: #d0a000;
}

.current-season-display {
    text-align: center;
    line-height: 1.1;
    background-color: var(--cor-fundo-claro);
    border-radius: 0.375rem;
    padding: 0.25rem 0.5rem;
    border: 1px solid var(--cor-borda);
}
.current-season-display small {
    font-size: 0.7em;
    text-transform: uppercase;
    color: var(--bs-secondary-color);
}

/* --- Painel de Escavação de Tesouros --- */
.treasure-grid-wrapper {
    display: grid;
    /* Define um grid com uma coluna para o eixo Y e uma para o grid principal */
    grid-template-columns: auto 1fr;
    /* Define uma linha para o eixo X e uma para o grid principal */
    grid-template-rows: auto 1fr;
    gap: 4px; /* Espaçamento entre os eixos e o grid */
    width: 100%;
    max-width: 450px; /* Um pouco maior para acomodar os eixos */
}

/* Posiciona o grid principal na área correta do wrapper */
.treasure-grid {
    grid-column: 2 / 3;
    grid-row: 2 / 3;
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    grid-template-rows: repeat(10, 1fr); /* Garante que as linhas também sejam de tamanho igual */
    gap: 2px; /* Espaçamento entre as células */
    width: 100%;
    aspect-ratio: 1 / 1; /* Mantém o grid quadrado */
    background-color: #a37b4e;
    padding: 8px;
    border-radius: 5px;
    border: 2px solid #7c5c3a;
    /* Remove margens e max-width que agora são controlados pelo wrapper */
    max-width: none;
    margin: 0;
}
.treasure-grid-axis {
    display: grid;
    position: relative; /* Contexto para os pseudo-elementos ::before */
    font-size: 0.7rem;
    font-weight: bold;
    color: #7c5c3a;
}
.treasure-grid-axis span {
    display: flex;
    align-items: center;
    justify-content: center;
}
.treasure-grid-axis-x {
    grid-column: 2 / 3;
    grid-row: 1 / 2;
    grid-template-columns: repeat(10, 1fr);
}
.treasure-grid-axis-x::before {
    content: 'X';
    position: absolute;
    left: -1px;
    /* Alinha na parte de baixo da célula do eixo para evitar sobreposição */
    bottom: -1px;
    font-size: 0.8rem;
}
.treasure-grid-axis-y {
    grid-column: 1 / 2;
    grid-row: 2 / 3;
    grid-template-rows: repeat(10, 1fr);
}
.treasure-grid-axis-y::before {
    content: 'Y';
    position: absolute;
    top: -5px;
    /* Alinha na parte direita da célula do eixo para evitar sobreposição */
    right: 0;
    font-size: 0.8rem;
}
.treasure-grid-cell {
    position: relative; /* Necessário para o posicionamento absoluto do ícone filho */
    border: 1px solid #7c5c3a;
    background-color: #c9a37d;
}
.treasure-grid-cell.hint-highlight::after {
    content: '';
    position: absolute;
    top: -1px; /* Ajusta para alinhar com a borda da célula */
    left: -1px;
    width: calc(100% + 2px);
    height: calc(100% + 2px);
    background-color: rgba(255, 255, 0, 0.35); /* Amarelo semi-transparente */
    border: 2px solid #ffc107; /* Borda amarela sólida */
    border-radius: 1px;
    pointer-events: none; /* Permite cliques através do overlay */
    box-sizing: border-box;
}
.treasure-grid-item-icon {
    position: absolute; /* Retira o ícone do fluxo de layout, fixando o tamanho da célula. */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    image-rendering: pixelated; /* Para imagens pixel art */
    padding: 2px; /* Adiciona o espaçamento dentro da imagem, não na célula */
}
.treasure-patterns-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    background-color: #00000033;
    padding: 10px;
    border-radius: 5px;
}
.treasure-pattern-item {
    position: relative; /* Necessário para o posicionamento do overlay de conclusão */
    background-color: rgba(255,255,255,0.1);
    border-radius: 5px;
    padding: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px; /* Espaço entre o grid e o nome */
}
.treasure-pattern-item.is-completed {
    opacity: 0.65; /* Suaviza a cor do item concluído */
}
.treasure-pattern-item.is-completed::after {
    content: '\f26a'; /* Bootstrap Icons: check-circle-fill */
    font-family: 'bootstrap-icons';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2.5rem;
    color: #198754; /* Cor de sucesso do Bootstrap */
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    line-height: 1;
}
.treasure-pattern-item img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    image-rendering: pixelated;
}
.pattern-mini-grid {
    display: grid;
    width: 100%;
    aspect-ratio: 1 / 1; /* Garante que o grid seja quadrado */
    gap: 2px;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
}
.pattern-mini-grid-name {
    font-size: 0.7rem;
    color: #00000096;
    text-align: center;
    width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.pattern-mini-grid-cell {
    position: relative; /* Torna a célula o ponto de referência para o ícone */
    background-color: rgba(0,0,0,0.2);
    border-radius: 2px;
}
.pattern-mini-grid-icon {
    position: absolute; /* Remove o ícone do fluxo de layout */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    image-rendering: pixelated;
    padding: 1px; /* Adiciona um pequeno espaçamento interno */
}

.bg-dark-subtle-item-list {
    background-color: rgba(0,0,0,0.15);
    border-radius: 5px;
}

/* --- Painel de Presentes (NPCs) --- */

#npc-gift-accordion .progress-bar {
    width: var(--progress-percent);
}

/* Aumenta o tamanho do avatar do NPC na lista */
#npc-gift-accordion .npc-avatar {
    height: 40px;
    width: 40px;
    object-fit: cover; /* Garante que a imagem preencha o círculo, cortando se necessário */
}

/* --- Painel de Mapa da Fazenda (Layout) --- */

/* --- Estilos para o Balão de Dicas Flutuante --- */

.floating-hints-balloon {
    position: fixed; /* Garante que o balão flutue em relação à janela do navegador */
    bottom: 20px;
    right: 20px;
    width: 90%;
    max-width: 380px;
    z-index: 1030; /* Um z-index alto para ficar sobre outros elementos, como a navbar */
    /* ALTERADO: Fundo mais claro para um visual menos "denso" e mais integrado */
    background-color: rgba(var(--bs-body-bg-rgb), 0.85);
    backdrop-filter: blur(8px); /* Aumenta o blur para melhor legibilidade */
    border: 1px solid var(--bs-border-color);
    /* NOVO: Borda inferior mais espessa para dar profundidade */
    border-bottom: 3px solid var(--bs-border-color);
    border-radius: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    /* Transição para os efeitos de ociosidade e movimento */
    transition: opacity 0.5s ease-in-out, box-shadow 0.5s ease-in-out, transform 0.3s ease-in-out;
    /* Adiciona margem na parte inferior para dar espaço ao "rabicho" do balão */
    margin-bottom: 12px;
    /* NOVO: Garante que a cor do texto seja legível no novo fundo */
    color: var(--bs-body-color);
}

/* "Rabicho" que dá a aparência de balão de fala */
/* Este é o "preenchimento" do rabicho */
.floating-hints-balloon::after {
    content: '';
    position: absolute;
    bottom: -12px; /* Posiciona abaixo do balão */
    right: 30px;
    border: 12px solid transparent;
    /* ALTERADO: Cor corresponde ao novo fundo */
    border-top-color: rgba(var(--bs-body-bg-rgb), 0.85);
    border-bottom: 0;
    z-index: 1; /* Garante que fique sobre a borda */
}

/* NOVO: Esta é a "borda" do rabicho, posicionada ligeiramente atrás */
.floating-hints-balloon::before {
    content: '';
    position: absolute;
    bottom: -15px; /* 3px mais baixo que o preenchimento (espessura da borda inferior) */
    right: 27px; /* 3px mais para a esquerda */
    border: 15px solid transparent;
    border-top-color: var(--bs-border-color); /* Cor da borda */
    border-bottom: 0;
    z-index: 0; /* Fica atrás do preenchimento */
}

/* Classe para o estado ocioso (translúcido) */
.floating-hints-balloon.is-idle {
    opacity: 0.6;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    cursor: pointer; /* Indica que pode ser "acordado" com um clique */
    /* NOVO: Move o balão um pouco para baixo quando ocioso para um efeito visual */
    transform: translateY(10px);
}

/* Desativa a transição durante o arrasto para evitar o efeito de "delay" ou "estilingue" */
.floating-hints-balloon.is-dragging-balloon {
    transition: none;
    opacity: 1; /* Garante que o balão fique totalmente opaco ao ser arrastado */
    transform: translateY(0); /* Garante que não haja transformação durante o arrasto */
}

.floating-hints-balloon .hints-header {
    padding: 0.5rem 1rem;
    cursor: move; /* ALTERADO: Indica que o cabeçalho é arrastável */
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--bs-border-color-translucent);
}

.floating-hints-balloon .hints-header h6 {
    font-size: 0.9rem;
    font-weight: bold;
    /* NOVO: Garante que o texto do cabeçalho continue com a cor de aviso */
    color: var(--bs-warning);
}

.floating-hints-balloon .hints-body {
    max-height: 220px; /* Limita a altura para evitar que ocupe a tela toda */
    overflow-y: auto; /* Adiciona scroll se o conteúdo for maior */
}

.floating-hints-balloon .accordion-button {
    padding: 0.75rem 1rem; /* Mais espaçamento vertical */
    font-size: 0.85rem;
    background-color: transparent;
    color: var(--bs-body-color);
}

.floating-hints-balloon .accordion-button:not(.collapsed) {
    box-shadow: none; /* Remove a sombra padrão do Bootstrap */
    background-color: rgba(var(--bs-primary-rgb), 0.1); /* Um fundo sutil quando aberto */
}

.floating-hints-balloon .accordion-button:focus {
    box-shadow: none; /* Remove o anel de foco */
}

/* Altera a cor do ícone de chevron do acordeão */
.floating-hints-balloon .accordion-button::after {
    filter: invert(75%) sepia(10%) saturate(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
}

.floating-hints-balloon .accordion-button:not(.collapsed)::after {
    filter: none; /* Volta à cor padrão quando aberto */
}

.floating-hints-balloon .accordion-body { padding: 0; }
.floating-hints-balloon .accordion-body .list-group-item {
    padding-left: 1rem;
    padding-right: 1rem;
}

/* Melhora a interatividade das dicas, indicando que são "clicáveis" no hover */
.floating-hints-balloon .list-group-item[data-highlight-coords] {
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
}

.floating-hints-balloon .list-group-item[data-highlight-coords]:hover {
    background-color: rgba(var(--bs-primary-rgb), 0.15) !important; /* !important para sobrepor o bg-transparent */
}

/* --- Estilos para o botão de Dicas Ativas --- */
#toggle-hints-balloon-btn .icon-on {
    display: none;
}

#toggle-hints-balloon-btn.active .icon-off {
    display: none;
}

#toggle-hints-balloon-btn.active .icon-on {
    display: inline-block;
}

.farm-layout-map .table {
    border-collapse: collapse;
    table-layout: fixed;
}

/* Célula base do mapa */
.farm-layout-cell, .farm-layout-cell-empty {
    width: 40px;
    height: 40px;
    padding: 0 !important;
    position: relative; /* Essencial para o posicionamento dos badges e conteúdo */
    white-space: nowrap;
    transition: opacity 0.3s ease-in-out, filter 0.3s ease-in-out;
    border: 1px solid #e9ecef; /* Borda sutil */
}

/* Célula que contém um recurso ou item */
.farm-layout-cell.has-content {
    background-color: #f8f9fa;
}

/* Cores de AOE dinâmicas usando variáveis CSS */
/* !important é usado para garantir que a cor da AOE sobreponha a cor de fundo padrão da célula */
.farm-layout-cell.has-aoe-color {
    background-color: var(--cell-bg-color) !important;
}

.farm-layout-cell.has-aoe-gradient {
    background: var(--cell-bg-gradient) !important;
}

/* Estilo para células escurecidas pelo filtro */
.farm-layout-cell.is-dimmed,
.map-item-overlay.is-dimmed {
    opacity: 0.3;
    filter: grayscale(80%);
}

/* Wrapper para centralizar o conteúdo principal da célula */
.cell-content-wrapper {
    display: flex;
    justify-content: center;
    align-items: center; /* Re-centraliza o conteúdo verticalmente */
    height: 100%;
    /* O padding foi removido daqui para permitir que o conteúdo filho use 100% do espaço. */
}

/* Container do ícone principal do recurso */
.resource-icon {
    position: relative; /* Âncora para o rótulo de rendimento */
    display: block; /* Garante que o container ocupe todo o espaço */
    width: 100%;
    height: 100%;
}

/* Ícones dentro do mapa */
.map-item-icon, .aoe-source-icon {
    max-width: 100%;
    max-height: 95%; /* Aumenta o tamanho para ocupar quase toda a célula, deixando uma pequena margem. */
    width: auto;
    height: auto;
    object-fit: contain;
}

/* Badge para contagens (minas/colheitas restantes) no canto da célula */
.cell-badge {
    position: absolute;
    top: 1px;
    right: 1px;
    z-index: 2;
    background-color: #ffc107;
    color: #212529;
    font-size: 0.65rem;
    font-weight: bold;
    padding: 1px 4px;
    border-radius: 0.5rem;
    line-height: 1.2;
}

/* Badge para recompensas bônus (ex: sementes) no canto da célula */
.bonus-reward-badge {
    position: absolute;
    top: 1px;
    left: 1px;
    z-index: 2;
    background-color: #0d6efd; /* Azul primário para destaque */
    color: white;
    font-size: 0.65rem;
    padding: 1px 4px;
    border-radius: 0.5rem;
    line-height: 1.2;
    /* Garante que o ícone dentro do badge não seja muito grande */
    display: flex;
    align-items: center;
    justify-content: center;
}
.bonus-reward-badge .bi {
    font-size: 0.6em; /* Ajusta o tamanho do ícone dentro do badge */
}

/* NOVO: Ícone para enxame de abelhas (bee swarm) */
.bee-swarm-badge {
    position: absolute;
    top: 1px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
    width: 10px; /* Tamanho do ícone */
    height: 10px; /* Tamanho do ícone */
    padding: 0.5px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

/* NOVO: Legenda de ícones dinâmica no topo do mapa */
.map-icon-legend {
    font-size: 0.75rem;
    color: var(--bs-secondary-color);
}

.map-legend-item {
    display: flex;
    align-items: center;
}

.map-legend-item img, .map-legend-item i {
    width: 14px;
    height: 14px;
    object-fit: contain;
}



/* NOVO: Estilos para a visualização de processamento em edifícios */
.processing-building-container {
    position: relative; /* Garante que os ícones de sobreposição sejam posicionados em relação a este container */
    display: inline-block; /* Ajusta o container ao tamanho da imagem base, criando a âncora correta */
}

.processing-building-container .base-building {
    opacity: 0.6; /* Torna o edifício base semi-transparente */
    filter: grayscale(30%);
}

/* Ícone de sobreposição para um único item (ex: Crop Machine) */
.processing-building-container .processing-content-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    /* NOVO: Estilo unificado para sobreposição, similar aos ícones da estufa */
    width: 20px;
    height: 20px;
    border: 1px solid #e0a85c;
    background-color: #fce4b3;
    border-radius: 3px;
    padding: 2px;
    box-sizing: border-box;
    z-index: 1; /* Garante que fique por cima */
}

/* NOVO: Ajustes para edifícios grandes (ex: 2x2) para preencher o espaço e evitar deformação */
.processing-building-container.large-building .map-item-icon {
    /* Garante que os ícones (base e sobreposição) dentro de um edifício grande
       possam ocupar todo o espaço, sobrepondo o max-height: 95% padrão. */
    max-width: 100%;
    max-height: 100%;
}

/* Badge para fertilizante de rendimento (posição dinâmica) */
.yield-fertiliser-badge {
    position: absolute;
    z-index: 2;
    width: 8px; /* Tamanho do ícone */
    height: 9px; /* Tamanho do ícone */
    padding: 0.5px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.yield-fertiliser-badge.pos-top-left {
    top: 1px;
    left: 1px;
}

.yield-fertiliser-badge.pos-top-right {
    top: 1px;
    right: 1px;
}

/* Rótulo para rendimento (amount) sobreposto na base do ícone */
.amount-label {
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.575);
    color: white;
    font-size: 0.60rem;
    font-weight: bold;
    padding: 1px 5px;
    border-radius: 0.3rem;
    line-height: 1;
    white-space: nowrap;
    z-index: 3;
}

/* NOVO: Estilos para a coluna da legenda ficar fixa durante a rolagem */
.farm-layout-map .legend-column {
    position: -webkit-sticky; /* Para compatibilidade com Safari */
    position: sticky;
    top: 20px; /* Distância do topo da tela */
    align-self: flex-start; /* Essencial para o 'sticky' funcionar dentro de um contêiner flex (row) */
}
/* NOVO: Estilos para a barra de filtro fixa no card de detalhes */
#floating-resource-card .sticky-filter-bar {
    position: sticky;
    top: -0.5rem; /* Compensa o padding do card-body para colar no topo */
    z-index: 2;
    background-color: rgba(var(--bs-body-bg-rgb), 0.95);
    backdrop-filter: blur(8px);
    /* Compensa o padding do card-body para ocupar a largura total */
    margin-left: -0.8rem;
    margin-right: -0.8rem;
    /* Adiciona o padding de volta para o conteúdo da barra */
    padding-left: 0.8rem;
    padding-right: 0.8rem;
 }

/*
/* NOVO: Wrapper para o conteúdo da legenda, permite rolagem interna se for muito alto */
.farm-layout-map .legend-content-wrapper {
    max-height: calc(100vh - 40px); /* Altura máxima baseada na tela, menos o espaçamento do topo */
    overflow-y: auto; /* Adiciona uma barra de rolagem vertical se necessário */
    padding-right: 10px; /* Espaço para a barra de rolagem não sobrepor o conteúdo */
}

/* Ícone que marca uma célula VAZIA que está sob efeito de AOE */
.aoe-effect-icon {
    font-size: 1.0rem;
    opacity: 0.6;
    /* Centraliza o ícone de magia se a célula estiver vazia */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* Legenda do mapa */
.farm-layout-legend {
    font-size: 0.8rem;
}
.farm-layout-legend li {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
}
.farm-layout-legend .legend-icon {
    width: 20px;
    height: 20px;
    object-fit: contain;
}

/* NOVO: Estilo para dividir a legenda de recursos em duas colunas quando necessário */
.farm-layout-legend.multi-column-legend {
    column-count: 2;
    column-gap: 1rem;
}

/* NOVO: Estilo para o gatilho de filtro de recurso na legenda */
.resource-filter-trigger {
    cursor: pointer;
    padding: 2px 8px;
    border-radius: 10px;
    transition: all 0.2s ease-in-out;
    border: 1px solid var(--cor-borda);
}

/* Novo estilo para o gatilho de filtro de AOE na legenda */
.aoe-filter-trigger {
    cursor: pointer;
    padding: 2px 8px;
    border-radius: 10px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
    transition: all 0.2s ease-in-out;
    border: 1px solid rgba(0,0,0,0.1);
    display: inline-block; /* Garante que o padding e o fundo sejam aplicados corretamente */
    /* Usa a variável CSS definida no HTML para o fundo dinâmico */
    background: var(--aoe-bg);
}

.resource-filter-trigger:hover,
.aoe-filter-trigger:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.resource-filter-trigger.active,
.aoe-filter-trigger.active {
    transform: scale(1.05);
    box-shadow: 0 0 0 3px var(--cor-primaria) !important; /* !important para sobrepor outros estilos */
    background-color: var(--cor-primaria) !important;
    color: white !important;
}

/* NOVO: Estilos para o Card Flutuante de Informações de Recursos */
#floating-resource-card {
    position: fixed;
    z-index: 1056; /* Acima da maioria dos outros elementos */
    min-width: 280px; /* Define uma largura mínima para o card */
    max-width: 450px; /* Impede que o card fique excessivamente largo */
    border: 1px solid var(--cor-borda);
    background-color: rgba(var(--bs-body-bg-rgb), 0.9);
    backdrop-filter: blur(8px);
    border-radius: 0.5rem; /* Reduzido de 0.75rem */
    display: none; /* Escondido por padrão */
    font-size: 0.8rem; /* Reduz o tamanho da fonte base para o card */
}

#floating-resource-card .card-header {
    cursor: move; /* Indica que o cabeçalho é arrastável */
    padding: 0.4rem 0.8rem; /* Reduzido de 0.5rem 1rem */
}

#floating-resource-card .card-header h6 {
    font-size: 0.9rem; /* Reduz o tamanho do título */
    margin-bottom: 0;
}

#floating-resource-card .card-body {
    padding: 0.8rem; /* Reduzido de 1rem */
    max-height: 350px; /* Reduzido de 400px */
    overflow-y: auto;
}

/* NOVO: Estilos para os itens da lista dentro do card para torná-los mais compactos */
#floating-resource-card .list-group-item {
    padding-top: 0.2rem !important;
    padding-bottom: 0.2rem !important;
    border: none; /* Remove as bordas padrão do list-group-flush para um visual mais limpo */
}

#floating-resource-card .buff-source {
    font-size: 0.75rem; /* Torna a fonte do bônus ainda menor */
    white-space: nowrap; /* Impede a quebra de linha do texto */
}

/* NOVO: Estilos para o Card Flutuante de Resumo */
#floating-summary-card {
    position: fixed;
    z-index: 1057; /* Um pouco acima do card de detalhes para garantir a sobreposição */
    width: 240px;
    border: 1px solid var(--cor-borda);
    background-color: rgba(var(--bs-body-bg-rgb), 0.9);
    backdrop-filter: blur(8px);
    border-radius: 0.5rem;
    display: none;
    font-size: 0.8rem;
}

#floating-summary-card .card-header {
    cursor: move;
    padding: 0.4rem 0.8rem;
}

#floating-summary-card .card-body {
    padding: 0.8rem;
    max-height: 350px;
    overflow-y: auto;
}
/* Para evitar seleção de texto ao arrastar */
body.is-dragging-card {
    user-select: none;
    -webkit-user-select: none;
}

.resource-info-trigger {
    cursor: pointer;
}

/* --- Overlay de Itens (Edifícios, etc.) --- */
.farm-layout-grid-container {
    position: relative; /* Contexto para o posicionamento dos itens */
}

.items-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Permite clicar através da camada de overlay */
    display: grid; /* NOVO: Define o contêiner como uma grade CSS */
}

.map-item-overlay {
    /* position: absolute; REMOVIDO: Agora é um item de grade */
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: auto;
    transition: transform 0.2s ease-in-out, opacity 0.3s ease-in-out, filter 0.3s ease-in-out;
    /* NOVO: Garante que o item preencha a área da grade designada */
    width: 100%;
    height: 100%;
}

.map-item-overlay:hover {
    transform: scale(1.05);
    z-index: 10;
}

/* --- Tags de Origem de Bônus --- */
.buff-source-tag {
    display: inline-block;
    padding: 0.1em 0.4em 0.15em;
    font-size: 0.75em;
    font-weight: 600;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 0.375rem;
    margin-right: 0.4em;
    background-color: var(--bs-secondary-bg-subtle);
    color: var(--bs-emphasis-color);
    border: 1px solid var(--bs-border-color-translucent);
}

/* Cores para os Badges de Prefixo de Bônus */

/* Skill (Azul) */
.buff-source-tag.is-type-skill {
    background-color: var(--bs-primary-bg-subtle);
    color: var(--bs-primary-text-emphasis);
    border-color: var(--bs-primary-border-subtle);
}

/* Skill Legacy (Cinza) */
.buff-source-tag.is-type-skill_legacy {
    background-color: #d4ab2393;
    color: var(--bs-secondary-text-emphasis);
    border-color:#d4ab23;
}

/* SFT/Collectible (Amarelo) */
.buff-source-tag.is-type-collectible {
    background-color: var(--bs-warning-bg-subtle);
    color: var(--bs-warning-text-emphasis);
    border-color: var(--bs-warning-border-subtle);
}

/* Wearable (Ciano) */
.buff-source-tag.is-type-wearable {
    background-color: var(--bs-info-bg-subtle);
    color: var(--bs-info-text-emphasis);
    border-color: var(--bs-info-border-subtle);
}

/* Bud / Fertilizante (Verde) */
.buff-source-tag.is-type-bud,
.buff-source-tag.is-type-fertiliser {
    background-color: var(--bs-success-bg-subtle);
    color: var(--bs-success-text-emphasis);
    border-color: var(--bs-success-border-subtle);
}

/* =================================
   COMPONENTES FLUTUANTES
   ================================= */

.currency-container {
    /* REATORAÇÃO: Usa display: grid para empilhar os elementos de moeda.
       Isso resolve o problema de "blur" ao garantir que o container pai
       sempre tenha um tamanho definido, evitando saltos de layout durante a animação. */
    display: inline-grid;
    align-items: center;
    perspective: 800px; /* Cria o espaço 3D para a animação de flip */
    /* Define uma altura mínima para evitar que o layout "salte" durante a troca */
    min-height: 1.0em; /* Ajuste conforme o tamanho da fonte */
}

/* --- Card Flutuante de Resumo --- */
#floating-summary-card {
    position: fixed;
    z-index: 1057; /* Um pouco acima do card de detalhes para garantir a sobreposição */
    width: 240px;
    border: 1px solid var(--cor-borda);
    background-color: rgba(var(--bs-body-bg-rgb), 0.9);
    backdrop-filter: blur(8px);
    border-radius: 0.5rem;
    display: none;
    font-size: 0.8rem;
}

#floating-summary-card .card-header {
    cursor: move;
    padding: 0.4rem 0.8rem;
}

#floating-summary-card .card-body {
    padding: 0.8rem;
    max-height: 350px;
    overflow-y: auto;
}
/* NOVO: Estilo para o container dos badges de taxa no card de resumo */
#floating-summary-card .tax-disclaimer-badges {
    font-size: 0.75rem;
}

/* NOVO: Estilo para o botão de acordeão compacto dentro dos cards flutuantes */
.accordion-button-sm {
    font-size: 0.75rem;
    color: var(--bs-secondary-color);
    font-weight: 600;
}
.accordion-button-sm:not(.collapsed) {
    color: var(--bs-primary);
    background-color: transparent !important;
}


/* --- Card Flutuante de Detalhes do Recurso --- */
#floating-resource-card {
    position: fixed;
    z-index: 1056; /* Acima da maioria dos outros elementos */
    min-width: 280px; /* Define uma largura mínima para o card */
    max-width: 450px; /* Impede que o card fique excessivamente largo */
    border: 1px solid var(--cor-borda);
    background-color: rgba(var(--bs-body-bg-rgb), 0.9);
    backdrop-filter: blur(8px);
    border-radius: 0.5rem; /* Reduzido de 0.75rem */
    display: none; /* Escondido por padrão */
    font-size: 0.8rem; /* Reduz o tamanho da fonte base para o card */
}

#floating-resource-card .card-header {
    cursor: move; /* Indica que o cabeçalho é arrastável */
    padding: 0.4rem 0.8rem; /* Reduzido de 0.5rem 1rem */
}

#floating-resource-card .card-header h6 {
    font-size: 0.9rem; /* Reduz o tamanho do título */
    margin-bottom: 0;
}

/* --- Sistema de Conversão de Moeda (Animação) --- */
.currency-value-display {
    /* REATORAÇÃO: Usa flexbox para alinhar perfeitamente o ícone (bandeira) e o texto do valor.
       Isso resolve o problema de "blur" ao garantir que o container pai
       sempre tenha um tamanho definido, evitando saltos de layout durante a animação.
    display: inline-flex;
    align-items: center;

    transition: transform 0.4s ease-in-out, opacity 0.2s ease-in-out;
    backface-visibility: hidden; /* Esconde a parte de trás do elemento durante a rotação */
    transform-style: preserve-3d;
    white-space: nowrap; /* Evita que o texto quebre a linha durante a animação */
    /* NOVO: Coloca todos os spans na mesma célula da grade para empilhá-los */
    grid-area: 1 / 1;
}

/* Estado padrão para todos os valores: rotacionados e invisíveis */
.currency-container .currency-value-display {
    /* CORREÇÃO: Adiciona translateZ(0) para forçar a renderização 3D e evitar o "blur" no ícone */
    transform: rotateX(90deg) translateZ(0);
    opacity: 0;
}

/* Estado para o valor que deve ser visível */
/* REFINAMENTO: Agrupa os seletores para reduzir a repetição. */
body.show-flower .currency-flower,
body.show-usd .currency-usd,
body.show-brl .currency-brl {
    transform: rotateX(0deg) translateZ(0);
    opacity: 1;
}
/* Fallback para o carregamento inicial: se nenhuma classe 'show-*' estiver no body, mostra SFL (Flower). */
body:not([class*='show-']) .currency-flower {
    transform: rotateX(90deg) translateZ(0);
    opacity: 0;
}

/* --- Painel de Controles Flutuante (Moeda) --- */
.floating-controls-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1040; /* Acima da maioria dos conteúdos, mas abaixo de modais */
    display: flex;
    flex-direction: column-reverse; /* Inverte a ordem para o painel aparecer acima do botão */
    align-items: flex-end;
    gap: 10px;
    /* NOVO: Adiciona uma transição suave para o efeito de esmaecer */
    transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
}

/* NOVO: Classe para o estado ocioso (esmaecido) */
/* Aplica o efeito apenas quando o painel não está aberto */
.floating-controls-container.is-idle:not(.open) {
    opacity: 0.4; /* Reduz a opacidade */
    transform: translateY(10px); /* Move ligeiramente para baixo */
    cursor: pointer; /* Indica que pode ser "acordado" com um clique */
}

#floating-controls-toggle {
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    transition: transform 0.2s ease-in-out;
}

#floating-controls-toggle:hover {
    transform: scale(1.1);
}

.floating-controls-panel {
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
    border: 1px solid var(--cor-borda);
    border-radius: 0.75rem;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    visibility: hidden;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
}

.floating-controls-container.open .floating-controls-panel {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
}

.currency-selector .form-check-label {
    cursor: pointer;
    display: flex;
    align-items: center;
    font-weight: 500;
}

/* --- Lógica de Exibição da Bandeira --- */
.currency-flag-container {
    /* REATORAÇÃO: Usa flexbox para garantir que o ícone da bandeira (seja img ou span)
       fique perfeitamente centralizado dentro do botão. */
    display: flex;
    align-items: center;
}

.currency-flag-container .currency-flag-display {
    display: none;
}
body.show-flower .currency-flag-display.currency-flower {
    display: inline-block;
}

body.show-usd .currency-flag-display.currency-usd {
    display: inline-block;
}

body.show-brl .currency-flag-display.currency-brl {
    display: inline-block;
}

/* =================================
   ÍCONE PERSONALIZADO PARA O SISTEMA DE BANDEIRAS
   ================================= */
.fi-flower {
    background-image: url('/static/images/resources/flower.webp');
    background-size: contain; /* Adicionado para garantir que o ícone não seja cortado */
}

/* Container para múltiplos ícones de sobreposição (ex: Estufa) */
.multi-overlay-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: grid; /* Alterado para grid para controle de colunas */
    grid-template-columns: repeat(3, 1fr); /* 3 colunas */
    gap: 2px; /* Espaço entre os ícones */
    justify-content: center; /* Centraliza os ícones horizontalmente */
    align-items: center; /* Centraliza os ícones verticalmente */
    z-index: 2;
    width: 100%; /* Garante que o container ocupe a largura total para o grid */
    max-width: 50px; /* Limita a largura para que os ícones se organizem em 3 colunas */
}

/* Estilo individual para cada ícone na sobreposição múltipla */
.multi-overlay-icon {
    width: 15px; /* Tamanho ajustado para caber múltiplos ícones em 3 colunas */
    height: 15px;
    border: 1px solid #e0a85c;
    background-color: #fce4b3;
    border-radius: 3px;
    padding: 1px;
    box-sizing: border-box; /* Garante que padding e borda estejam inclusos no tamanho */
}

/* NOVO: Aumenta visualmente a imagem da Crop Machine */
.processing-building-container.large-building .map-item-icon.base-building[alt="Crop Machine"] {
    transform: scale(1.2); /* Aumenta a imagem em 20% */
    z-index: 1; /* Garante que ela fique acima de outros elementos menores se houver sobreposição */
}



/* =================================
   MEDIA QUERIES PARA RESPONSIVIDADE
   ================================= */
@media (max-width: 991px) {
    #inventory-grid {
        column-count: 2;
    }
}

@media (max-width: 576px) {
    #inventory-grid {
        column-count: 1;
    }
}

/* =================================
   Estilos para a Máscara de Dicas de Posição
   ================================= */
.rules-mask-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: transparent; /* Fundo transparente por padrão */
    z-index: 5; /* Acima do item, mas abaixo de qualquer highlight */
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    font-size: 0.8em;
    pointer-events: none; /* Permite cliques através do overlay */
    opacity: 0; /* Escondido por padrão */
    transition: opacity 0.3s ease-in-out;
}

.rules-mask-overlay.active {
    opacity: 1; /* Visível quando ativo */
}

/* Estilos específicos para células de areia (sand_blocks) */
.treasure-grid-cell[data-sand-block="True"] .rules-mask-overlay {
    background-color: rgba(238, 60, 5, 0.3); /* Laranja para areia, mais discreto */
}

/* Estilos específicos para células com dica de caranguejo (crab_hints) */
.treasure-grid-cell[data-crab-hint="True"] .rules-mask-overlay {
    background-color: rgba(49, 196, 62, 0.3); /* Verde para caranguejo, mais discreto */
}

/* --- Crop Machine Global Buffs Button & Panel --- */
#floating-resource-card .card-header .global-buffs-btn {
    position: absolute;
    top: -2rem; /* Posição ajustada para ficar abaixo do cabeçalho */
    right: 0rem; /* Position it to the left of the close button */
    background: #fff;
    border: 1px solid var(--cor-borda);
    border-radius: 0.5rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.global-buffs-panel {
    position: fixed; /* Use fixed to position relative to the viewport */
    z-index: 1055; /* Just below the main resource card */
    width: 260px;
    display: none; /* Hidden by default */
    border: 1px solid var(--cor-borda);
    background-color: rgba(var(--bs-body-bg-rgb), 0.9);
    backdrop-filter: blur(8px);
    border-radius: 0.5rem;
    font-size: 0.8rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.global-buffs-panel .card-body {
    padding: 0.8rem;
    max-height: 350px;
    overflow-y: auto;
}