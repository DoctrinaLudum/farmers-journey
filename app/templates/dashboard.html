{% extends "base.html" %}

{% block content %}
<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="bi bi-person-badge-fill me-2"></i>Painel de {{ username }} (#{{ farm_id }})</h3>
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary btn-sm">Buscar outra fazenda</a>
    </div>

    {% if error %}
    <div class="alert alert-danger" role="alert">
        <strong>Erro:</strong> {{ error }}
    </div>
    {% endif %}

    <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview-pane" type="button" role="tab" aria-controls="overview-pane" aria-selected="true">
                <i class="bi bi-grid-1x2-fill me-1"></i> Visao Geral
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory-pane" type="button" role="tab" aria-controls="inventory-pane" aria-selected="false">
                <i class="bi bi-box-seam-fill me-1"></i> Inventario
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="expansion-tab" data-bs-toggle="tab" data-bs-target="#expansion-pane" type="button" role="tab" aria-controls="expansion-pane" aria-selected="false">
                <i class="bi bi-arrows-fullscreen me-1"></i> Assessor de Expansão
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="fishing-tab" data-bs-toggle="tab" data-bs-target="#fishing-pane" type="button" role="tab" aria-controls="fishing-pane" aria-selected="false">
                <i class="bi bi-fish me-1"></i> Peixes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="flowers-tab" data-bs-toggle="tab" data-bs-target="#flowers-pane" type="button" role="tab" aria-controls="flowers-pane" aria-selected="false">
                <i class="bi bi-flower2 me-1"></i> Flores
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="treasure_dig-tab" data-bs-toggle="tab" data-bs-target="#treasure_dig-pane" type="button" role="tab" aria-controls="treasure_dig-pane" aria-selected="false">
                <i class="bi bi-unlock-fill me-1"></i> Escavação de Tesouros
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="wood-tab" data-bs-toggle="tab" data-bs-target="#wood-pane" type="button" role="tab" aria-controls="wood-pane" aria-selected="false">
                <i class="bi bi-tree-fill me-1"></i> Wood
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="mining-tab" data-bs-toggle="tab" data-bs-target="#mining-pane" type="button" role="tab" aria-controls="mining-pane" aria-selected="false">
                <i class="bi bi-gem me-1"></i> Mineração
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="debug-tab" data-bs-toggle="tab" data-bs-target="#debug-pane" type="button" role="tab" aria-controls="debug-pane" aria-selected="false">
                <i class="bi bi-bug-fill me-1"></i> Recursos (Debug)
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="layout-map-tab" data-bs-toggle="tab" data-bs-target="#layout-map-pane" type="button" role="tab" aria-controls="layout-map-pane" aria-selected="false">
                <i class="bi bi-map-fill me-1"></i> Mapa da Fazenda
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="buds-tab" data-bs-toggle="tab" data-bs-target="#buds-pane" type="button" role="tab" aria-controls="buds-pane" aria-selected="false">
                <i class="bi bi-bug-fill me-1"></i> Buds
            </button>
        </li>
    </ul>

    <div class="tab-content" id="dashboardTabsContent">
        <div class="tab-pane fade show active" id="overview-pane" role="tabpanel" aria-labelledby="overview-tab">
            {% include 'partials/_geral_panel.html' %}
        </div>

        <div class="tab-pane fade" id="expansion-pane" role="tabpanel" aria-labelledby="expansion-tab">
            {% include 'partials/_expansion_panel.html' %}
        </div>

        <div class="tab-pane fade" id="inventory-pane" role="tabpanel" aria-labelledby="inventory-pane">
            {% include 'partials/_inventory_panel.html' %}
        </div>

        <div class="tab-pane fade" id="fishing-pane" role="tabpanel" aria-labelledby="fishing-pane">
            {% include 'partials/_fishing_panel.html' %}
        </div>

        <div class="tab-pane fade" id="flowers-pane" role="tabpanel" aria-labelledby="flowers-tab">
            {% include 'partials/_flowers_panel.html' %}
        </div>

        <div class="tab-pane fade" id="treasure_dig-pane" role="tabpanel" aria-labelledby="treasure_dig-pane">
            {% include 'partials/_treasuredig_panel.html' %}
        </div>
        
        <div class="tab-pane fade" id="wood-pane" role="tabpanel" aria-labelledby="wood-tab">
            {% include 'partials/_wood_panel.html' %}
        </div>

        <div class="tab-pane fade" id="mining-pane" role="tabpanel" aria-labelledby="mining-tab">
            {% include 'partials/_mining_panel.html' %}
        </div>

        <div class="tab-pane fade" id="debug-pane" role="tabpanel" aria-labelledby="debug-tab">
            {% include 'partials/_debug_resources_panel.html' %}
        </div>

        <div class="tab-pane fade" id="layout-map-pane" role="tabpanel" aria-labelledby="layout-map-tab">
            {% include 'partials/_layout_map_panel.html' %}
        </div>

        <div class="tab-pane fade" id="buds-pane" role="tabpanel" aria-labelledby="buds-tab">
            {% include 'partials/_buds_panel.html' %}
        </div>
    </div>
</div>

<template id="goal-list-template">
    <p class="card-text small text-muted mb-2">
        Plano para Nível <strong data-template="goal-level"></strong> da Ilha <strong data-template="goal-land-type" class="text-capitalize"></strong>:
    </p>
    <div class="d-flex justify-content-around small text-muted border-bottom pb-2 mb-2">
        <span><i class="bi bi-person-check-fill me-1"></i>Nv. Bumpkin: <strong data-template="bumpkin-level"></strong></span>
        <span><i class="bi bi-clock-history me-1"></i>Tempo: <strong data-template="total-time"></strong></span>
    </div>
    <div class="row small text-muted mb-2 text-center">
        <div class="col-6">
            Custo Total<img src="{{ url_for('static', filename='images/resources/flower.webp') }}" alt="SFL" class="mx-1 icon icon-1x">: <strong data-template="total-cost"></strong>
        </div>
        <div class="col-6">
            Custo Relativo<img src="{{ url_for('static', filename='images/resources/flower.webp') }}" alt="SFL" class="mx-1 icon icon-1x">: <strong data-template="total-relative-cost"></strong>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6 pe-md-2"><ul class="list-group list-group-flush" data-column="1"></ul></div>
        <div class="col-md-6 ps-md-2"><ul class="list-group list-group-flush" data-column="2"></ul></div>
    </div>
</template>

<template id="goal-list-item-template">
     <li class="list-group-item d-flex justify-content-between align-items-center compact-list-item px-0">
         <span class="d-flex align-items-center">
             <img src="" alt="" class="me-2 icon icon-2x" data-template="icon">
             <span data-template="name"></span>
         </span>
         <div class="text-end">
             <span class="badge" data-template="shortfall"></span>
             <small class="text-muted d-block" style="font-size: 0.75em;" data-template="value_of_needed"></small>
             <small class="text-muted d-block" style="font-size: 0.75em;">
                <img src="{{ url_for('static', filename='images/resources/flower.webp') }}" alt="SFL" class="icon icon-1x">
                <span data-template="sfl_value"></span>
            </small>
         </div>
     </li>
</template>

<template id="unlocks-summary-table-template">
  <div class="mt-4 pt-3 border-top">
    <h6 class="fw-bold mb-2">Desbloqueios e Ganhos na Jornada</h6>
    <div class="table-responsive">
      <table class="table table-sm table-hover small">
        <thead>
            <tr>
                <th style="width: 40px;"></th> {# Coluna vazia para o ícone #}
                <th>Item</th>
                <th class="text-end">Total Ganho</th>
            </tr>
        </thead>
        <tbody data-template="summary-table-body">
          </tbody>
      </table>
    </div>
  </div>
</template>

<template id="unlocks-summary-item-template">
  <tr data-template="item-row">
    <td class="text-center" style="width: 40px;">
        <img src="" alt="" class="icon icon-2x" data-template="icon" onerror="this.style.display='none'">
    </td>
    <td>
        <span data-template="name"></span>
    </td>
    <td class="text-end fw-bold" data-template="total"></td>
  </tr>
</template>
{% endblock %}


{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}" type="module"></script>
{% endblock %}